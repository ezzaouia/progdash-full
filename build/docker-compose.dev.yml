version: '2'

services:
  mongodb:
    volumes:
      - progdash-mongo-data:/data/db
      - progdash-mongo-config:/data/configdb
    ports:
      - 27017:27017

  mongoadmin:
    ports:
      - 8081:8081

  java:
    build:
      context: ./
      dockerfile: ./build/dockerfiles/java/Dockerfile
    command: >
            /bin/bash -c "envsubst < /opt/progdash/application.properties > /opt/progdash/application.properties
            && /usr/bin/java -jar /opt/progdash/webservices.jar"

  nginx:
    build:
      context: ./
      dockerfile: ./build/dockerfiles/nginx/Dockerfile
    ports:
      - 8090:80

  cronjobs:
    build:
      context: ./
      dockerfile: ./build/dockerfiles/cronjobs/Dockerfile
    volumes:
      - progdash-mongo-backup:/data/backups

volumes:
  progdash-mongo-data:
    driver: local
  progdash-mongo-config:
    driver: local
  progdash-mongo-backup:
    driver: local