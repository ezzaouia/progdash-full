<?xml version="1.0" encoding="UTF-8"?><!--Converted at: Fri Oct 21 17:05:47 CEST 2016-->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.woonoz.pv.progdash.dao.mapper.LearningStatisticsMapper">

	<select id="getLastSessionId" resultType="java.lang.Integer">
		SELECT MAX(id)
		FROM learning_session
		WHERE user_id = #{userId}
	</select>
	
	<select id="getGroups" resultType="com.woonoz.pv.progdash.dao.dbo.GroupDbo">
		SELECT id_groupe id, nom_groupe name
		FROM woonoz_groupe
		WHERE id_groupe_p = #{areaId};
	</select>

	<select id="countAreaUsers" resultType="java.lang.Integer">
		SELECT COUNT(*)
		FROM woonoz_groupe_p_membre
		WHERE id_groupe_p = #{areaId}
		      AND user_role = 'learner';
	</select>

	<select id="countGroupUsers" resultType="java.lang.Integer">
		SELECT COUNT(*)
		FROM woonoz_groupe_membre
		WHERE id_groupe = #{groupId};
	</select>

	<select id="getAreaFromGroup" resultType="java.lang.Integer">
		SELECT id_groupe_p
		FROM woonoz_groupe
		WHERE id_groupe = #{groupId};
	</select>
	
	<select id="getUsersIdentity" resultType="com.woonoz.pv.progdash.dao.dbo.UserIdentityDbo">
		SELECT
		       wm.id_membre id,
		       CONCAT(wm.prenom_membre, " ", wm.nom_membre) fullName
		FROM  woonoz_groupe_p_membre wgpm
		  JOIN woonoz_membre wm ON wm.id_membre = wgpm.id_membre
		WHERE wgpm.id_groupe_p = #{areaId}
		  AND wgpm.user_role = 'learner';
	</select>

</mapper>